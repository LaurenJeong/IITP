<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="frmLogin" width="480" height="610" titletext="로그인화면" onload="form_onload">
    <Layouts>
      <Layout height="610" mobileorientation="portrait" width="480">
        <View id="viewLogin" taborder="0" text="viewLogin" viewdataset="viewdataset" left="85" top="120" right="85" bottom="150" cssclass="viw_box">
          <Layouts>
            <Layout>
              <Button id="btnLogin" left="20" height="60" right="20" bottom="20" cssclass="btn_login" text="Login" onclick="viewLogin_btnLogin_onclick"/>
              <Static id="staUserIdLabel" left="20" top="20" width="268" height="-1" text="ID" cssclass="sta_login_label"/>
              <Edit id="edtUserId" left="20" top="29" height="50" width="268" password="false" displaynulltext="ID"/>
              <Static id="staUserPwLabel" left="20" top="89" width="268" height="-1" text="비밀번호" cssclass="sta_login_label"/>
              <Edit id="edtUserPw" left="20" top="98" height="50" width="268" password="true" displaynulltext="Password"/>
              <CheckBox id="chkSaveId" left="20" top="158" height="60" right="0" text="Save User ID" cssclass="chk_login"/>
            </Layout>
          </Layouts>
          <Objects>
            <Dataset id="viewdataset">
              <ColumnInfo>
                <Column id="USER_ID" type="STRING" size="80" description="ID"/>
                <Column id="USER_PW" type="STRING" size="80" description="비밀번호"/>
              </ColumnInfo>
              <Rows>
                <Row>
                  <Col id="USER_ID">user1</Col>
                  <Col id="USER_PW">1234</Col>
                </Row>
              </Rows>
            </Dataset>
          </Objects>
          <Bind>
            <BindItem id="bind_edtUserId" compid="edtUserId" propid="value" datasetid="viewdataset" columnid="USER_ID"/>
            <BindItem id="bind_edtUserPw" compid="edtUserPw" propid="value" datasetid="viewdataset" columnid="USER_PW"/>
          </Bind>
          <ModelInfo modelserviceid="model" serviceid="getlogin" modelid="dsinput" filepath="login\getlogin.xmodel">
            <Fields>
              <Field id="USER_ID" description="" comptype="auto" password="false" compwidth="100%" compheight="60px" labelsize="-1" fieldposition="vertical" displaynulltext="ID" cssclass="" labelcssclass="sta_login_label"/>
              <Field id="USER_PW" description="" comptype="auto" password="true" compwidth="100%" compheight="60px" labelsize="-1" fieldposition="vertical" displaynulltext="Password" cssclass="" labelcssclass="sta_login_label"/>
            </Fields>
            <Components>
              <Component id="btnLogin" fields="_viewcomp"/>
              <Component id="staUserIdLabel" fields="USER_ID"/>
              <Component id="edtUserId" fields="USER_ID"/>
              <Component id="staUserPwLabel" fields="USER_PW"/>
              <Component id="edtUserPw" fields="USER_PW"/>
              <Component id="chkSaveId" fields="_viewcomp"/>
            </Components>
          </ModelInfo>
          <ViewTemplateInfo filepath="LoginViewTemplateM.xviewgen">
            <Attribute id="loginbuttontype" value="bottom"/>
            <Attribute id="loginbuttontext" value="Login"/>
            <Attribute id="loginbuttoncssclass" value="btn_login"/>
            <Attribute id="saveidcheckboxuse" value="true"/>
            <Attribute id="saveidcheckboxtext" value="Save User ID"/>
            <Attribute id="saveidcheckboxcssclass" value="chk_login"/>
            <Attribute id="viewpadding" value="20"/>
          </ViewTemplateInfo>
        </View>
        <Button id="btnJoin" taborder="1" text="회원가입" top="viewLogin:10" height="40" cssclass="btn_login_next" width="100" right="85"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/**
*  @MenuPath    로그인
*  @FileName	로그인.xfdl
*  @Desction	거래원장
*******************************************************************************
*  2022.10.13		Creator			최초 생성
*******************************************************************************
*/
/**************************************************************************
 * include 영역 
 **************************************************************************/ 
/**************************************************************************
 * FORM 변수 선언 영역
 **************************************************************************/
this.objApp = nexacro.getApplication();

/**************************************************************************
 * FORM EVENT 영역(onload)
 **************************************************************************/
/**
 * @description form onload
 */
this.form_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	
};

/**************************************************************************
 * CALLBACK 콜백 처리부분(Transaction)
 **************************************************************************/
 
/**************************************************************************
 * CRUD 및 TRANSACTION 서비스 호출 처리
 **************************************************************************/
 
/**************************************************************************
 * 사용자 FUNCTION 영역
 **************************************************************************/
/**
 * @description  로그인처리
 */
this.fnSetLogin = function()
{
	// [참고] DB에서 처리해야되는 내용을 임의로 처리함.
	// 해당 User가 있는지 체크
	var sFind = "USER_ID=='" + this.viewLogin.form.viewdataset.getColumn(0,"USER_ID") + "'";
		sFind += " && USER_PW=='" + this.viewLogin.form.viewdataset.getColumn(0,"USER_PW") + "'";
	
	var nRow = this.objApp.dbUser.findRowExpr(sFind);
	
	if (nRow < 0) {
		alert("ID 또는 패스워드가 잘못되었습니다.");
		return;
	}
	
	// 사용자 정보 설정
	this.objApp.gdsUserInfo.copyRow(0,this.objApp.dbUser,nRow);
	
	// 주문정보 설정
	var oDbOrder = this.objApp.dbOrder;
	oDbOrder.filter("USER_ID=='" + this.viewLogin.form.viewdataset.getColumn(0,"USER_ID") + "'");
	
	// 주문정보 임의데이터 설정
	var sTodayTime = this.gfnGetDate("milli");
	var sToday = sTodayTime.substr(0,8);
	for(var i=0; i<oDbOrder.rowcount; i++)
	{
		if (this.gfnIsNull(oDbOrder.getColumn(i,"ORDER_NO")))
		{
			oDbOrder.setColumn(i,"ORDER_NO",this.gfnGetUniqueId());
			oDbOrder.setColumn(i,"ORDER_TIME",this.gfnAddDate(sToday,(-1*i)-1) + sTodayTime.substr(8));
		}
	}
	
	// 메인화면으로 전환
	this.objApp.gvFrmAll.fnAction("LOGIN", true);
}
/**************************************************************************
* 각 COMPONENT 별 EVENT 영역
**************************************************************************/
this.viewLogin_btnLogin_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fnSetLogin();
};
]]></Script>
    <Objects>
      <PopupAction id="PopupAction00" formurl="QUICKCODE::adduserpop.xfdl" popupstyle="modal" popupid="popup" title="회원가입" targetview="viewLogin" popupdatatype="replace" popupleft="-1" popuptop="-1" popupwidth="-1" popupheight="-1">
        <Contents><![CDATA[{
    "model":[
        {
            "viewid":"viewLogin",
            "modelid":"dsinput",
            "iotype":"input",
            "fieldlist":[
                {
                    "name":"viewLogin:USER_ID",
                    "fieldid":"USER_ID",
                    "value":"USER_ID"
                }
            ]
        }
    ]
}]]></Contents>
      </PopupAction>
    </Objects>
    <Trigger>
      <TriggerItem id="item0" triggertype="Click" triggerview="frmLogin" triggerobj="btnJoin" targetaction="PopupAction00" condition=""/>
    </Trigger>
  </Form>
</FDL>
