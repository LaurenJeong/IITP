<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="test_20230103_01" width="1050" height="600" titletext="server source 가져오기">
    <Layouts>
      <Layout height="600" width="1050">
        <Edit id="edtPgmPath" taborder="0" left="20" top="19" width="100" height="30" value="sample" text="sample"/>
        <Button id="btnGetSource" taborder="1" text="Get Source" left="396" top="19" width="100" height="30" onclick="btnGetSource_onclick"/>
        <Edit id="edtPgmId" taborder="2" left="131" top="19" width="249" height="30" value="Vaccination.xfdl" text="Vaccination.xfdl"/>
        <TextArea id="txaOutPut" taborder="3" left="21" top="61" width="475" height="490"/>
        <Button id="Button00" taborder="4" text="Button00" left="692" top="19" width="120" height="50" onclick="Button00_onclick"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[this.fv_formContents = "";
this.fv_formLayouts;
this.fv_formObjects;
this.fv_formTrigger;
this.fv_formScript;

this.btnGetSource_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// http://localhost:8080/service/FileRead.jsp
	
	var sArgument = "";
	var sSvcID = "getSource";
	var sController = "svc::service/FileRead.jsp";
	sArgument += "ProjectId="+"QuickCode";
	sArgument += " FilePath="+this.edtPgmPath.value;
	sArgument += " FileNm="+this.edtPgmId.value;
	//trace(sArgument);
	var sInDatasets = "";
	var sOutDatasets = "dsContents=output";
	var sCallbackFunc = "fnCallback";

	this.transaction(sSvcID, sController, sInDatasets, sOutDatasets, sArgument, sCallbackFunc);
};

this.fnCallback = function(strSvcID, nErrorCode, strErrorMag) 
{
	trace("strSvcID : " + strSvcID + " nErrorCode : " + nErrorCode + " strErrorMag : " + strErrorMag);
	
	var sContents = this.dsContents.getColumn(0,"contents");
	
	this.txaOutPut.set_value(sContents);
	
	this.fv_formContents = sContents;
	this.fnGetFormContents(sContents);
};

this.fnGetFormContents = function(sContents) 
{
	var domPar = new nexacro.DomParser();
	var objXml = new nexacro.XmlSerializer();
	var domDoc;
	var referenceNode, formNode;
	var formChildNodes, oChildren;
	var sXML;
	
	domDoc = domPar.parseFromString(sContents);
	
	referenceNode = domDoc.firstChild;
	if(!referenceNode)		return;
	
	// 첫번째 Node
	formNode = referenceNode.firstChild;
	
	this.fv_formLayouts = null;
	this.fv_formObjects = null;
	this.fv_formTrigger = null;
	this.fv_formScript = null;
			
	while(formNode)
	{
		formChildNodes = formNode.childNodes;
		
		for (var i = 0; i < formChildNodes.length; i++)
		{
			oChildren = formChildNodes[i];
			//sXML = objXml.serializeToString(oChildren);
			
			if (oChildren.tagName == "Layouts")
			{
				this.fv_formLayouts = oChildren;
				
			}
			else if (oChildren.tagName == "Objects")
			{
				this.fv_formObjects = oChildren;
			}
			else if (oChildren.tagName == "Trigger")
			{
				this.fv_formTrigger = oChildren;
			}
			else if (oChildren.tagName == "Script")
			{
				this.fv_formScript = oChildren;
			}
			//trace(oChildren.tagName);
		}
		
		// 다음 Node
		formNode = formNode.nextSibling;
	}
};

this.fnGetChildContents = function(oContents, sTag) 
{
	var arrChildNodes = oContents.childNodes;
	var oChildren;
	var arrChild = new Array();
		
	for (var i = 0; i < arrChildNodes.length; i++)
	{
		oChildren = arrChildNodes[i];
		
		if (oChildren.tagName == sTag)
		{
			arrChild.push(oChildren);
		}
	}
	
	return arrChild;
};

this.Button00_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var objXml = new nexacro.XmlSerializer();
	
	var oLayouts = this.fv_formLayouts;
	var sXML = objXml.serializeToString(oLayouts);
	//trace(sXML);
	
	var arrView = this.fnGetChildContents(oLayouts.firstChild,"View");
	trace(arrView.length);
	
	var sXML = objXml.serializeToString(arrView[0]);
	trace(sXML);
};


]]></Script>
    <Objects>
      <Dataset id="dsContents"/>
      <Dataset id="dsView">
        <ColumnInfo>
          <Column id="VIEW_NAME" type="STRING" size="256"/>
          <Column id="MODEL_ID" type="STRING" size="256"/>
          <Column id="MODEL_PATH" type="STRING" size="256"/>
          <Column id="VIEWTEMPLATE_ID" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
  </Form>
</FDL>
